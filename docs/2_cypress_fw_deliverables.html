<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <title>Cypress Mbed OS Documentation: Cypress Firmware Deliverables in Mbed OS</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea" style="font-family:verdana;">
        <table border='0' cellpadding='0' cellspacing='0' width="98%">
          <tr style="height:20px"><td>&nbsp;</td></tr>
          <tr style="border-collapse: collapse; padding: 0;">
            <td style="width:20px"></td>
            <td style="width:117px"><img src="cypress_logo.png" alt="Cypress Logo" /></td>
            <td style="width:20px;background-image:url('cypresslogo_line.png');"></td>
            <td style="vertical-align:middle; text-align:center; font: bold 25px/100% Verdana, Arial, Helvetica, sans-serif;background-image:url('cypresslogo_line.png');">
              Cypress Mbed OS Documentation
            </td>
          </tr>
          <tr><td>&nbsp;</td></tr>
        </table>
    </div>
    <!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('2_cypress_fw_deliverables.html','');});
/* @license-end */
</script>
<div id="doc-content">

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Cypress Firmware Deliverables in Mbed OS </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This article provides details on the firmware deliverables from Cypress in Mbed&trade; OS. Figure 1 shows the architecture of Mbed OS (Source: <a href="https://os.mbed.com/docs/mbed-os/latest/introduction/index.html">Mbed OS Documentation</a>). For a general overview of Mbed OS, refer to the documentation at&#160;<a href="https://os.mbed.com/docs/">https://os.mbed.com/docs/</a>.</p>
<center><b>Figure 1</b></center><div class="image"> <img src="2_cypress_fw_deliverables_files/mbed_os_architecture.png" alt="2_cypress_fw_deliverables_files/mbed_os_architecture.png" width="800px" class="inline"/>
</div><p>This article provides details on relevant components highlighted in orange color in Figure 1 that are provided by Cypress. Specifically, the following firmware deliverables are covered:</p>
<ul>
<li>
<a href="#hal"><b>Hardware Abstraction Layer (HAL)</b></a> </li>
<li>
<a href="#bsp"><b>Board Support Package (BSP)</b></a> </li>
<li>
<a href="#wifi_ble"><b>Wi-Fi and BLE Implementation</b></a> </li>
</ul>
<h1><a class="anchor" id="hal"></a>
1.  Hardware Abstraction Layer (HAL)</h1>
<p>Mbed OS provides a hardware abstraction layer (HAL) for the microcontrollers it runs on, so that developers can focus on writing C/C++ applications that call functionality available on a range of hardware. This includes drivers for common peripherals like Digital/Analog I/O pins, I2C, UART, SPI, Quad SPI, PWM, etc. See <a href="https://os.mbed.com/docs/mbed-os/latest/apis/drivers.html">https://os.mbed.com/docs/mbed-os/latest/apis/drivers.html</a> for details on using Driver APIs. See <a href="https://os.mbed.com/docs/mbed-os/latest/tutorials/index.html">https://os.mbed.com/docs/mbed-os/latest/tutorials/index.html</a> for examples for using driver APIs. Figure 2 shows how Cypress PSoC 6 MCU HAL, Mbed HAL, and Mbed OS drivers are related in an Mbed OS application.</p>
<center><b>Figure 2</b></center><div class="image"> <img src="2_cypress_fw_deliverables_files/pdl_hal_mbed_os.png" alt="2_cypress_fw_deliverables_files/pdl_hal_mbed_os.png" width="600px" border="2" class="inline"/>
</div><h2>1.1&#160;&#160;&#160;PSoC 6 MCU Peripheral Driver Library</h2>
<p>The Peripheral Driver Library (PDL) simplifies software development for the PSoC 6 MCU architecture. PDL reduces the need to understand register usage and bit structures, thus easing software development for the extensive set of peripherals available.&#160; PDL contains no Mbed OS-specific information and should be usable in all RTOS environments.&#160;In Mbed OS, the PSoC 6 MCU PDL is present in the&#160;<em>mbed-os\targets\TARGET_Cypress\ TARGET_PSOC6\psoc6pdl</em>&#160;directory.&#160;The PDL documentation can be found at&#160;<a href="https://cypresssemiconductorco.github.io/psoc6pdl/pdl_api_reference_manual/html/index.html">PSoC 6 PDL API Reference Manual</a>.</p>
<h2>1.2&#160;&#160;&#160;PSoC 6 HAL</h2>
<p>PSoC 6 MCU HAL provides a high-level interface for interacting with PSoC 6 MCU peripherals. This interface abstracts chip-specific details.&#160;If any chip-specific functionality is necessary, or performance is critical,&#160;the low-level functions provided in PSoC 6 MCU PDL can be used directly. PSoC 6 MCU HAL&#160;is present in the&#160;<em>mbed-os\targets\TARGET_Cypress\TARGET_PSOC6\psoc6csp</em>&#160;directory.&#160;</p>
<h2>1.3&#160;&#160;&#160;Mbed HAL</h2>
<p>To enable seamless porting of application code between different Arm<sup>&reg;</sup> Cortex<sup>&reg;</sup>-M-based devices, Mbed OS provides an Mbed HAL layer for using different peripherals. The Mbed HAL API (header files) is available in the&#160;<em>\mbed-os\hal</em>&#160;directory. The equivalent Mbed HAL API implementation (source files) for PSoC 6 MCU is provided by Cypress in the&#160;<em>\mbed-os\targets\TARGET_Cypress\TARGET_PSOC6</em>&#160;directory. The Cypress implementation of the Mbed HAL relies mostly on the PSoC 6 MCU HAL APIs, and where necessary the PSoC 6 MCU PDL APIs.</p>
<h2>1.4&#160;&#160;&#160;Mbed Drivers</h2>
<p>Mbed OS provides a C++ wrapper for commonly used MCU peripherals and functionalities. These are available in the the&#160;<em>\mbed-os\drivers</em>&#160;directory.</p>
<h1><a class="anchor" id="bsp"></a>
2.  Board Support Package</h1>
<p>In Mbed OS, a &lsquo;target&rsquo; refers to the hardware development kit. Cypress provides the Target Implementation, also known as a Board Support Package (BSP), for all the Mbed OS-enabled kits from Cypress. Details of BSP are provided below.</p>
<h2>2.1&#160;&#160;&#160;Targets List</h2>
<p>The list of targets (BSPs) supported in Mbed OS by all the partners, and the respective target configurations is available in the file&#160;<em>mbed-os\targets\targets.json</em>. This file includes the Cypress targets supported in Mbed OS as well.&#160;For more information on the target configuration parameters in this file, see <a href="https://os.mbed.com/docs/mbed-os/latest/reference/adding-and-configuring-targets.html">https://os.mbed.com/docs/mbed-os/latest/reference/adding-and-configuring-targets.html</a>.</p>
<h2>2.2&#160;&#160;&#160;Target-Specific Board Support Package</h2>
<p>Cypress target BSPs are available in the <em>\mbed-os\targets\TARGET_Cypress\TARGET_PSOC6</em> directory. Each target has a directory in the format&#160;<em>TARGET_TARGETNAME.</em>&#160;For example, CY8CKIT-062-WiFi-BT target folder is <em>TARGET_CY8CKIT_062_WiFi_BT</em> as shown in Figure 3.</p>
<center><b>Figure 3</b></center><div class="image"> <img src="2_cypress_fw_deliverables_files/wifi_bt_target.png" alt="2_cypress_fw_deliverables_files/wifi_bt_target.png" width="250px" class="inline"/>
</div><p>BSP handles target hardware initialization code, configuration settings, startup code, linker scripts, etc. The information on BSP files provided in the target folder is specified in the table below.</p>
<table class="doxtable">
<tr bgcolor="#D2D2D2">
<td width="234"><p class="starttd"></p>
<p class="intertd"><b>Files, Folder in Target Implementation</b></p>
<p class="endtd"></p>
</td><td width="810"><p class="starttd"></p>
<p class="intertd"><b>Details</b></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td width="234"><p class="starttd"></p>
<p class="intertd">cybsp_target_name.c, cybsp_target_name.h</p>
<p class="endtd"></p>
</td><td width="810"><p class="starttd"></p>
<p class="intertd">Contains the Initialization function&#160;cybsp_init()&#160;for the target. This function initializes the on-board components like LEDs, buttons, and debug UART.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td width="234"><p class="starttd"></p>
<p class="intertd">cybsp_types.h</p>
<p class="endtd"></p>
</td><td width="810"><p class="starttd"></p>
<p class="intertd">Contains definitions for the on-board components like LEDs and buttons. These definitions are used in the BSP initialization code.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td width="234"><p class="starttd"></p>
<p class="intertd">design.modus&#160;file and&#160;<em>Generated Source</em> folder</p>
<p class="endtd"></p>
</td><td width="810"><p class="starttd"></p>
<p class="intertd">The design.modus file is used internally by BSP files for BSP configuration. It is responsible for holding the hardware configuration information of PSoC 6 MCU host as used on the target hardware. This file can be viewed, if needed, in the "Device Configurator" tool from ModusToolbox. The configuration files generated from design.modus are stored in the&#160;Generated Source&#160;folder.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td width="234"><p class="starttd"></p>
<p class="intertd">PinNames.h</p>
<p class="endtd"></p>
</td><td width="810"><p class="starttd"></p>
<p class="intertd">Contains the mapping of the on-board interfaces to the host MCU pins. Examples include LEDs, buttons, Arduino header pins, and I2C/UART/SPI interface pins.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td width="234"><p class="starttd"></p>
<p class="intertd">PeripheralNames.h</p>
<p class="endtd"></p>
</td><td width="810"><p class="starttd"></p>
<p class="intertd">Contains the mapping of the Mbed OS peripheral names to the PSoC 6 MCU functional block instances. This includes UART, SPI, I2C, PWM etc.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td width="234"><p class="starttd"></p>
<p class="intertd">PeripheralPins.c</p>
<p class="endtd"></p>
</td><td width="810"><p class="starttd"></p>
<p class="intertd">Contains the mapping of the PSoC 6 MCU Host pins, block instance name, and the specific functionality of the pin in relation to that block instance (Like P1[0] is mapped to UART_0 Instance, and serves as UART_RX pin).</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td width="234"><p class="starttd"></p>
<p class="intertd">device&#160;folder</p>
<p class="endtd"></p>
</td><td width="810"><p class="starttd"></p>
<p class="intertd">Contains the startup code and linker scripts for different toolchains</p>
<p class="endtd"></p>
</td></tr>
</table>
<h2>2.3&#160;&#160;&#160;PSoC 6 MCU CM0+ CPU Image</h2>
<p>Cypress provides&#160;precompiled application images that are executed on Cortex M0+ core of the dual-CPU PSoC 6 MCU. These images are in the&#160;&#160;<em>\mbed-os\targets\TARGET_Cypress\TARGET_PSOC6\psoc6cm0p</em>&#160;folder. The images are provided as C arrays ready to be compiled as part of the Cortex M4 application. The Cortex M0+ application code is placed into the internal flash by the Cortex M4 linker script. The details of the different CM0+ image types are provided below.</p>
<ul>
<li>
<u>TARGET_CM0P_SLEEP</u>: This folder contains CM0+ image that starts the CM4 core at CY_CORTEX_M4_APPL_ADDR=0x10002000, and puts the CM0+ core in to Deep Sleep mode. This CM0+ image takes 8 KB of flash and 8 KB of SRAM. The CM0+ core also handles system call operations like Flash memory programming. Separate images are provided inside the \TARGET_CM0P_SLEEP folder for the different PSoC 6 MCU families. </li>
</ul>
<h1><a class="anchor" id="wifi_ble"></a>
3.  Wi-Fi and BLE Implementation</h1>
<p>Figure 4 shows the layers of the Wi-Fi and BLE protocol implementation in a PSoC 6 MCU and CYW43xxx based solution in Mbed OS.</p>
<center><b>Figure 4</b></center><div class="image"> <img src="2_cypress_fw_deliverables_files/wifi_ble_implementation.png" alt="2_cypress_fw_deliverables_files/wifi_ble_implementation.png" width="600px" class="inline"/>
</div><p>The WLAN subsystem of CYW43xxx communicates with PSoC 6 MCU through the SDIO interface. SDIO interface consists of 6 signals &ndash; SDIO_CMD, SDIO_CLK, and SDIO_DATA[3:0]. The WLAN susbsytem on CYW43xxx includes the 802.11 physical layer (PHY) and the 802.11 Media Access Control (MAC) layer. The upper layers of the Wi-Fi protocol including the network stack, and the higher layer protocols (IP, TCP/UDP, HTTP, MQTT etc) are handled in PSoC 6 MCU.</p>
<p>The Bluetooth (BT) subsystem of CYW43xxx communicates with PSoC 6 MCU through the HCI UART interface with flow control enabled (TX, RX, RTS, CTS). The Bluetooth susbsytem on CYW43xxx implements the controller portion of the BLE stack which includes the radio and the link layer. The Host portion of the BLE stack, BLE profiles, and the application code reside on PSoC 6 MCU.</p>
<p>In addition to the SDIO and UART interfaces, there are also six control signals between the PSoC 6 MCU and CYW43xxx devices. These include the power control signals (WL_REG_ON, BT_REG_ON), CYW43xxx device wakeup signals (WL_DEV_WAKE, HOST_DEV_WAKE), and PSoC 6 MCU host wakeup signals (WL_HOST_WAKE, BT_HOST_WAKE). See the CYW43xxx device datasheet for details on these control signals, SDIO, and UART interfaces.</p>
<p>The following sections provide details on the Cypress firmware deliverables relevant to Wi-Fi and BLE.</p>
<h2>3.1&#160;&#160;&#160;Wi-Fi Firmware Deliverables</h2>
<h3>3.1.1&#160;&#160;&#160;&#160;Wi-Fi Host Driver (WHD)</h3>
<p>Wi-Fi Host Driver (WHD) is the driver firmware running on the host MCU (PSoC 6 MCU) that&#160;uses the underlying communication interface (typically, but not restricted to, SDIO interface) to interface with the WLAN subsystem of the CYW43xxx device.&#160;WHD provides WLAN APIs which can be used by upper layers of the host MCU software framework. These include APIs for functionality such as scan, join, and SoftAP. Cypress provides the WHD firmware as part of Mbed OS in the <em>mbed-os\targets\TARGET_Cypress\TARGET_PSOC6\TARGET_WHD</em> folder.&#160;</p>
<p>In addition to the driver firmware, the WHD folder also contains other resources as listed below.</p>
<ul>
<li>
WLAN firmware for CYW43xxx devices in the&#160;<em>\TARGET_WHD\resources\firmware</em> folder. The firmware folder also contains the CLM (Country Locale Matrix) Blob file. See the application note&#160;<a href="https://www.cypress.com/documentation/application-notes/an225347-cypress-wi-fi-clm-regulatory-manual">AN225347</a> for more details on CLM Blob. </li>
<li>
NVRAM file corresponding to the hardware platforms in&#160;the&#160;<em>\TARGET_WHD\resources\nvram</em> folder. This file contains the board hardware configuration settings like RF configuration and antenna settings. </li>
</ul>
<h3>3.1.2&#160;&#160;&#160;&#160;Ethernet MAC (EMAC)</h3>
<p>The WHD to Mbed Ethernet MAC (EMAC) driver interface is maintained in the <em>mbed-os\features\netsocket\emac-drivers\TARGET_WHD</em> folder. &#160;See <a href="https://os.mbed.com/docs/mbed-os/v5.13/porting/ethernet-port.html">https://os.mbed.com/docs/mbed-os/v5.13/porting/ethernet-port.html</a> more details on the EMAC driver for WiFi.</p>
<h3>3.1.3&#160;&#160;&#160;&#160;LWIP Network Stack</h3>
<p>Each board that supports Wi-Fi connectivity needs to be added to the&#160;<em>mbed-os\features\lwipstack\mbed_lib.json</em>&#160;file with appropriate settings. The LWIP stack settings for the Cypress kits with Wi-Fi functionality have been added to this file.</p>
<h3>3.1.4&#160;&#160;&#160;&#160;Network Socket APIs</h3>
<p>The application programming interface for IP networking is the Socket API. The Socket API relates to OSI layer 4, the transport layer. In Mbed OS, the Socket API is abstracted, and supports various protocols such as TCP and UDP.&#160;For information on Mbed OS Network Socket APIs, refer to&#160;<a href="https://os.mbed.com/docs/mbed-os/latest/apis/network-socket.html">https://os.mbed.com/docs/mbed-os/latest/apis/network-socket.html</a>.&#160;</p>
<h3>3.1.5&#160;&#160;&#160;&#160;Network Interface APIs</h3>
<p>A socket requires a NetworkInterface instance to indicate which NetworkInterface the socket should be created on. The NetworkInterface provides a network stack that implements the underlying socket operations. NetworkInterface is also the controlling API that the application uses to specify the network configuration.&#160;For information on Mbed OS Network Interface APIs, refer to&#160;<a href="https://os.mbed.com/docs/mbed-os/latest/apis/network-interfaces.html">https://os.mbed.com/docs/mbed-os/latest/apis/network-interfaces.html</a>.</p>
<h2>3.2&#160;&#160;&#160;BLE Firmware Deliverables</h2>
<p>CYW43xxx Wi-Fi/BT combo devices (CYW43012, CYW4343W) contain the dual-mode Bluetooth radio and controller functionality. The Bluetooth subsystem in these combo devices interface with a PSoC 6 MCU Host thorugh the HCI UART interface, and the BLE host stack runs on PSoC 6 MCU. Mbed OS does not support Classic Bluetooth. The abstraction layer between the Cypress BLE implementation and the Cordio BLE stack are located in <em>mbed-os\features\FEATURE_BLE\targets\TARGET_Cypress</em>.&#160;</p>
<p>Arm Mbed BLE, also called&#160;BLE_API, is the Bluetooth Low Energy software solution for Mbed OS. Developers can use it to create new BLE-enabled applications. Mbed OS&rsquo;s&#160;BLE_API&#160;interfaces with the BLE controller on the platform. It hides the BLE stack&rsquo;s complexity behind C++ abstractions and is compatible with all BLE-enabled Mbed platforms. For more information on the BLE APIs, see <a href="https://os.mbed.com/docs/mbed-os/latest/apis/ble.html">https://os.mbed.com/docs/mbed-os/latest/apis/ble.html</a>.&#160;</p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
    <!-- start footer part -->
    <div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
      <ul>
        <li class="footer">Copyright Cypress Corporation.</li>
      </ul>
    </div>
  </body>
</html>
